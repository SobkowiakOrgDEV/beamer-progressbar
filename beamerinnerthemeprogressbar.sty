\ProvidesPackage{beamerinnerthemeprogressbar}[2011/05/02]

% Beamer theme by Sylvain Bouveret <sylvain[dot]bouveret[aT]cert[DoT]fr>
% based on the LaTeX-Beamer package :
%
% Copyright 2003 by Till Tantau <tantau@users.sourceforge.net>
%
% This program can be redistributed and/or modified under the terms
% of the GNU Public License, version 2.

% This fork was created to satisfy personnal taste in code.
%
% Last modified by CÃ©dric Mauclair.


\mode<presentation>
\usetikzlibrary[fadings]


%<< Bibliography       >>

\definecolor{bibstruct}{rgb}{0.95,0.95,0.85}
\setbeamercolor{bibliography structure}{fg=normal text.fg, bg=bibstruct}

% no new macro to learn for the user
\let\bibliographyorig\bibliography
\def\bibliography#1{%
  \begin{center}
    \begin{tikzpicture}
      \usebeamercolor{bibliography structure}
      \node [draw=fg!20!bg, fill=bg, rounded corners=2pt]
        {\parbox{0.95\textwidth}{\bibliographyorig{#1}\vskip2mm}};
    \end{tikzpicture}
  \end{center}}

\defbeamertemplate*{bibliography item}{progressbar theme}{
  \begin{tikzpicture}[rounded corners=1pt]
    \usebeamercolor{structure}
    \useasboundingbox
      (0,0.25) rectangle (0.4,0.5);
    \path [fill=fg!25!bg]
      (0,0.25) rectangle (0.4,0.5);
    \path[shade, bottom color=bg, top color=fg!25!bg]
      (0,0) -- (0.3,0) -- (0.4,0.12) -- (0.4,0.3) -- (0,0.3) -- cycle;
    \path [shade, left color=bg, right color=fg!30!bg]
      (0,0.27) .. controls (0.25,0.25) .. (0.4,0.5) -- (0,0.5) -- cycle;
    \path [fill=bg!80!fg]
      (0,0) rectangle (0.3,0.05);
    \path [shade, left color=bg!95!fg, right color=bg!80!fg]
      (0,0) rectangle (0.05,0.5);
    \path [shade, left color=bg, right color=bg!50!fg, shading angle=45]
      (0.3,0) -- (0.3,0.12) -- (0.4,0.12) -- cycle;
    \path [draw=fg!35!bg]
      (0,0) -- (0.3,0) -- (0.4,0.12) -- (0.4,0.5) -- (0,0.5) -- cycle;
    \path [draw=fg!35!bg]
      (0.3,0) -- (0.3,0.12) -- (0.4,0.12);
  \end{tikzpicture}}

\def\bibitem{%
  \@ifnextchar<
    \beamer@bibitem@store
    {\gdef\beamer@bibstore{}\beamer@plainbibitem}}
\def\beamer@bibitem@store<#1>{%
  \gdef\beamer@bibstore{<#1>}\beamer@plainbibitem}
\def\beamer@plainbibitem{%
  \@ifnextchar[\@lbibitem\beamer@bibitem}
\def\@lbibitem[#1]#2{%
  \expandafter\item\beamer@bibstore[\@biblabel{#1}\hfill]%
  \@ifundefined{beamerbib@#2@\the\c@framenumber}
    {\if@filesw%
      {\let\protect\noexpand%
        \immediate\write\@auxout%
        {\string\bibcite{#2}{\noexpand\hyperlink{beamerbib#2}{#1}}}}\fi%
      \global\@namedef{beamerbib@#2@\the\c@framenumber}{\relax}%
      \hypertarget{beamerbib#2}{}%
    }{}%
    \def\newblock{\beamer@newblock}\newblock\hskip-0.8ex}% This is really dirty !
\def\beamer@bibitem#1{\@bibitem{#1}\ignorespaces}
\def\@bibitem#1{%
  \expandafter\item\beamer@bibstore\@ifundefined{beamerbib@#1@\the\c@framenumber}%
  {\if@filesw \immediate\write\@auxout
    {\string\bibcite{#1}{\noexpand\hyperlink{beamerbib#1}{\the\value{\@listctr}}}}\fi%
    \global\@namedef{beamerbib@#1@\the\c@framenumber}{\relax}%
    \hypertarget{beamerbib#1}{}}%
  {}%
  \def\newblock{\beamer@newblock}\newblock}

%>>
%<< Blocks             >>

\newcommand\defblocktemplate[2][]{%
  \if @#2@
    \edef\doit{\noexpand\defsetblock[\noexpand#1]
      {block begin} {block end}
      {block title} {block body}}
  \else
    \edef\doit{\noexpand\defsetblock[\noexpand#1]
      {block #2 begin} {block #2 end}
      {block title #2} {block body #2}}
  \fi
  \def\defsetbeamertemplate{\defbeamertemplate*}%
  \doit}

\newcommand\setblocktemplate[2][]{%
  \if @#2@
    \edef\doit{\noexpand\defsetblock[\noexpand#1]
      {block begin} {block end}
      {block title} {block body}}
  \else
    \edef\doit{\noexpand\defsetblock[\noexpand#1]
      {block #2 begin} {block #2 end}
      {block title #2} {block body #2}}
  \fi
  \def\defsetbeamertemplate##1##2{\setbeamertemplate{##1}}%
  \doit}

\newcommand\defsetblock[5][]{%
  % block begin
  \defsetbeamertemplate{#2}{progressbar}{%
    % fix spurious spaces around itemize (kinda hackish)
    \addtobeamertemplate{itemize/enumerate body begin}
      {\kern-0.85\topsep}{}
    \addtobeamertemplate{itemize/enumerate body end}
      {}{\kern-\dimexpr0.85\topsep+0.25\topskip\relax}% seems ok
    % put content into boxes
    \setbox\@tempboxa=\hbox to 0.95\textwidth\bgroup
      \vbox\bgroup
        \raggedright
        \begin{minipage}{0.95\textwidth}
          % deal with optional title
          \ifx\insertblocktitle\@empty
          \else
            {\usebeamerfont{#4}\usebeamercolor[fg]{#4}\insertblocktitle}\\[-0.3cm]
            % NOTE TO MYSELF: better use this syntax with babel
            \begin{tikzpicture}
              \draw[draw=fg!20!bg, #1] (0,0) -- ++(\textwidth,0);
            \end{tikzpicture}% avoid spurious space
          \fi
          \usebeamerfont{#5}\usebeamercolor[fg]{#5}% avoid spurious space
  }
  % ----------------------------------------
  % block end
  \defsetbeamertemplate{#3}{progressbar}{%
        \end{minipage}% avoid spurious space
      \egroup% end vbox
    \egroup% end hbox
    % use boxes to typeset content
    \@tempdima\wd\@tempboxa
    \@tempdimb\ht\@tempboxa
    \advance\@tempdimb\dp\@tempboxa
    \usebeamercolor{#5}% avoid spurious space
    \hbox to\textwidth{%
      \hfill
      \begin{tikzpicture}
        \node[draw=fg!20!bg, fill=bg, rounded corners=2pt, #1]
          at (0.5\@tempdima,0.5\@tempdimb)
          {\box\@tempboxa};
      \end{tikzpicture}% avoid spurious space
      \hfill}\vskip0.25\baselineskip}% put some space after block
}

% #1 optional argument can be used to tweak default definition
% should be treated as key/val list with pgfkeys
\defblocktemplate{}% default block has no name
\defblocktemplate{alerted}
\defblocktemplate{example}

% \defblocktemplate uses \defbeamertemplate* (one time only)
% \setblocktemplate uses \setbeamertemplate

%>>
%<< Frame title        >>

\def\pb@separator{--}
\edef\NORMAL{normal}
\edef\PICTURESUBSECTION{picture-subsection}

\defbeamertemplate*{frametitle}{progressbar}{
  \ifx\pb@frametitle\NORMAL
    {\centering\usebeamerfont{frametitle}%
     \usebeamercolor[fg]{frametitle}\insertframetitle\endgraf}
  \else
    \ifx\pb@frametitle\PICTURESUBSECTION
      \parbox[c]{0.13\textwidth}{
        \includegraphics[width=0.12\textwidth]{\pb@imagename}}
      \parbox[c]{0.85\textwidth}{%
        \usebeamercolor[fg]{frametitle}
        \ifx\insertsection\@empty\else
          \insertsection\fi\\[-3mm]
        \ifx\insertsubsection\@empty\else
          \space\pb@separator\space\insertsubsection\fi
        \rule{0.7\textwidth}{0.5pt}\endgraf
        {\usebeamerfont{frametitle}\strut\insertframetitle}}
    \else
      \parbox[c]{0.13\textwidth}{
        \includegraphics[width=0.12\textwidth]{\pb@imagename}}
      \parbox[c]{0.85\textwidth}{%
        \usebeamercolor[fg]{frametitle}
        \ifx\insertsection\@empty\else
          \insertsection\fi\\[-3mm]
        \rule{0.7\textwidth}{0.5pt}\endgraf
        {\usebeamerfont{frametitle}\strut\insertframetitle}}
    \fi
  \fi}

%>>
%<< Items              >>

% %\setbeamertemplate{items}[circle]
% %\setbeamertemplate{itemize item}{\begin{tikzpicture}\draw[draw=pb@bgblue!60!white,fill=pb@bgblue!40!white] (0, 0) circle (0.07);\end{tikzpicture}}
% \setbeamertemplate{itemize item}{
%   \begin{tikzpicture}\shade[ball color=fg!80!bg] (0, 0) circle (0.07);\draw[draw=fg!50!black!90!bg] (0, 0) circle (0.07);\end{tikzpicture}%
% }
% \setbeamertemplate{itemize subitem}{\begin{tikzpicture}\shade[ball color=fg!80!white] (0, 0) circle (0.05);\draw[draw=fg!50!black!90!bg] (0, 0) circle (0.05);\end{tikzpicture}}
% \setbeamertemplate{itemize subsubitem}{\begin{tikzpicture}\shade[ball color=fg!80!white] (0, 0) circle (0.05);\draw[draw=fg!50!black!90!bg] (0, 0) circle (0.05);\end{tikzpicture}}

% % \setbeamertemplate{enumerate item}{\raisebox{-0.4ex}{\begin{tikzpicture}\shade[ball color=structure.fg!80!white] (0, 0) circle (0.07);\draw  (0, 0) node [draw=structure.fg!50!black!90!bg, inner sep=1pt] {\tiny\color{white}\bf\insertenumlabel};\end{tikzpicture}}}
% % \setbeamertemplate{enumerate subitem}{\raisebox{-0.4ex}{\begin{tikzpicture}\shade[ball color=structure.fg!80!white] (0, 0) circle (0.07);\draw  (0, 0) node [draw=structure.fg!50!black!90!bg, inner sep=1pt] {\tiny\color{white}\bf\insertenumlabel};\end{tikzpicture}}}
% \setbeamertemplate{enumerate item}{\raisebox{-0.4ex}{\begin{tikzpicture}\node [draw=fg!50!black!90!bg, inner sep=1pt, shading=ball, circle, ball color=fg!80!white] {\tiny\color{bg}\bf\insertenumlabel};\end{tikzpicture}}}
% \setbeamertemplate{enumerate subitem}{\raisebox{-0.4ex}{\begin{tikzpicture}\node [draw=fg!50!black!90!bg, inner sep=1pt, shading=ball,circle, ball color=fg!80!white] {\tiny\color{bg}\bf\insertenumlabel};\end{tikzpicture}}}

% \normalsize
% \pgfdeclareradialshading[bg,parent.bg]{tocsphere}{\pgfpoint{-0.5ex}{0.6ex}}%
% {%
%   color(0cm)=(structure.fg!35!white);
%   color(0.44ex)=(structure.fg!75!white);
%   color(0.88ex)=(structure.fg!70!black!90!bg);
%   color(1.2ex)=(structure.fg!50!black!90!bg);
%   color(1.3ex)=(structure.fg!50!black!90!bg)}

% \pgfdeclareradialshading[structure.fg,bg]{bigsphere}{\pgfpoint{-0.1849315ex}{.2260273ex}}%
% {%
%   color(0cm)=(structure.fg!15);
%   color(0.1643835ex)=(structure.fg!75);
%   color(0.3287671ex)=(structure.fg!70!black);
%   color(0.4520547ex)=(structure.fg!50!black);
%   color(0.53ex)=(structure.fg!50!black)}

% \pgfdeclareradialshading[structure.fg,bg]{smallsphere}{\pgfpoint{-0.1479452ex}{0.18287671ex}}%
% {%
%   color(0cm)=(structure.fg!15);
%   color(0.1315068ex)=(structure.fg!75);
%   color(0.2630136ex)=(structure.fg!70!black);
%   color(0.36164383ex)=(structure.fg!50!black);
%   color(0.427ex)=(bg)}


% \setbeamertemplate{section in toc}
% {\leavevmode%
%   \raisebox{-0.5ex}{\begin{tikzpicture}\node [draw=fg!50!black!90!bg, inner sep=1.5pt, shading=ball, circle, ball color=fg!80!white] {\scriptsize\color{bg}\bf\inserttocsectionnumber};\end{tikzpicture}}
%   \inserttocsection\par
% }

% \mode<handout>
% \setbeamertemplate{frametitle}{
%   \setbeamercolor{frametitle}{fg=structure.fg,bg=white}
%   \usebeamercolor{frametitle}
%   {\color{fg}\bf \insertframetitle}
% }

%>>

%%% Local Variables:
%%% TeX-master: "./demo.tex"
%%% End:
